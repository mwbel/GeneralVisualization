<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{TITLE}} - {{MODULE}}</title>
  <link rel="stylesheet" href="../../../assets/style.css" />
</head>
<body>
  <div class="container">
    <div class="breadcrumb">
      <a href="../../../../index.html">万物可视化</a>
      <span class="sep">/</span>
      <a href="../index.html">{{MODULE}}</a>
      <span class="sep">/</span>
      <span>{{TITLE}}</span>
    </div>

    <div class="header">
      <h1>{{TITLE}}</h1>
      <div class="actions">
        <a class="button secondary" href="../index.html">返回模块索引</a>
      </div>
    </div>

    <p style="color:#6b7280; margin-bottom: 16px;">{{SUMMARY}}</p>

    <div id="viz"></div>

    <div class="footer">
      <span>概念ID：<strong>{{ID}}</strong></span>
      <span>模块：<strong>{{MODULE}}</strong></span>
    </div>
  </div>

  <script type="module">
    const params = { id: '{{ID}}', module: '{{MODULE}}', viz: '{{VIZ}}', dataPath: '{{DATAPATH}}' };
    initViz(params);

    async function initViz({ id, module, viz }) {
      if (viz === 'plotly') {
        // 懒加载 Plotly
        await import('https://cdn.plot.ly/plotly-2.27.0.min.js').catch(() => {});
        if (!window.Plotly) {
          document.getElementById('viz').textContent = 'Plotly 加载失败';
          return;
        }
        const x = Array.from({ length: 200 }, (_, i) => i / 20);
        const y = x.map(v => Math.sin(v));
        const trace = { x, y, type: 'scatter', mode: 'lines', line: { color: '#667eea' } };
        const layout = { margin: { t: 20, r: 20, b: 40, l: 40 }, title: `${module} - ${id}`, paper_bgcolor: '#fff', plot_bgcolor: '#fff' };
        window.Plotly.newPlot('viz', [trace], layout);
      } else if (viz === 'canvas') {
        // TODO: canvas 示例
        const el = document.getElementById('viz');
        const c = Object.assign(document.createElement('canvas'), { width: el.clientWidth - 20, height: 300 });
        el.appendChild(c);
        const ctx = c.getContext('2d');
        ctx.strokeStyle = '#764ba2';
        ctx.beginPath();
        for (let i = 0; i < c.width; i++) {
          const x = i / 30;
          const y = Math.sin(x) * 40 + 100;
          i === 0 ? ctx.moveTo(i, y) : ctx.lineTo(i, y);
        }
        ctx.stroke();
      } else if (viz === 'threejs') {
        // TODO: threejs 示例（留占位）
        document.getElementById('viz').textContent = 'Three.js 示例待实现';
      } else {
        document.getElementById('viz').textContent = '未知可视化类型';
      }
    }
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒé¡¹åˆ†å¸ƒB(n,p)å¯è§†åŒ–ç¤ºä¾‹</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .control-group {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin: 5px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .control-group input, .control-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background: #2980b9;
        }
        .plot-container {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .stats-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² äºŒé¡¹åˆ†å¸ƒ B(n,p) å¯è§†åŒ–ç¤ºä¾‹</h1>
        
        <div class="description">
            <h3>ğŸ“š äºŒé¡¹åˆ†å¸ƒç®€ä»‹</h3>
            <p><strong>äºŒé¡¹åˆ†å¸ƒ B(n,p)</strong> æè¿°äº†åœ¨næ¬¡ç‹¬ç«‹çš„ä¼¯åŠªåˆ©è¯•éªŒä¸­ï¼ŒæˆåŠŸæ¬¡æ•°Xçš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>
            <ul>
                <li><strong>å‚æ•°n</strong>ï¼šè¯•éªŒæ¬¡æ•°</li>
                <li><strong>å‚æ•°p</strong>ï¼šæ¯æ¬¡è¯•éªŒæˆåŠŸçš„æ¦‚ç‡</li>
                <li><strong>æœŸæœ›å€¼</strong>ï¼šE[X] = n Ã— p</li>
                <li><strong>æ–¹å·®</strong>ï¼šVar[X] = n Ã— p Ã— (1-p)</li>
            </ul>
        </div>

        <div class="controls">
            <div class="control-group">
                <label for="visualization-type">å¯è§†åŒ–ç±»å‹ï¼š</label>
                <select id="visualization-type">
                    <option value="fixed-n">å›ºå®šnï¼Œå˜åŒ–p</option>
                    <option value="fixed-p">å›ºå®špï¼Œå˜åŒ–n</option>
                    <option value="3d-surface">3Då‚æ•°è¡¨é¢</option>
                </select>
            </div>
            <div class="control-group">
                <label for="n-value">nå€¼ï¼š</label>
                <input type="number" id="n-value" value="20" min="1" max="100">
            </div>
            <div class="control-group">
                <label for="p-value">på€¼ï¼š</label>
                <input type="number" id="p-value" value="0.5" min="0.01" max="0.99" step="0.01">
            </div>
            <button onclick="generateVisualization()">ç”Ÿæˆå¯è§†åŒ–</button>
            <button onclick="showExample()">æ˜¾ç¤ºç¤ºä¾‹</button>
        </div>

        <div id="plot1" class="plot-container"></div>
        <div id="stats" class="stats-info"></div>
        <div id="plot2" class="plot-container"></div>
    </div>

    <script>
        // äºŒé¡¹åˆ†å¸ƒæ¦‚ç‡è´¨é‡å‡½æ•°
        function binomialPMF(k, n, p) {
            function factorial(num) {
                if (num <= 1) return 1;
                return num * factorial(num - 1);
            }
            
            function combination(n, k) {
                if (k > n) return 0;
                return factorial(n) / (factorial(k) * factorial(n - k));
            }
            
            return combination(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
        }

        // ç”Ÿæˆå›ºå®šnï¼Œå˜åŒ–pçš„å¯è§†åŒ–
        function generateFixedN() {
            const n = 20;
            const pValues = [0.1, 0.3, 0.5, 0.7, 0.9];
            const colors = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd'];
            
            const traces = [];
            
            pValues.forEach((p, index) => {
                const k = Array.from({length: n + 1}, (_, i) => i);
                const pmf = k.map(ki => binomialPMF(ki, n, p));
                
                traces.push({
                    x: k,
                    y: pmf,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `p = ${p}`,
                    line: { color: colors[index], width: 3 },
                    marker: { size: 8, color: colors[index] }
                });
            });

            const layout = {
                title: 'äºŒé¡¹åˆ†å¸ƒ B(20,p) - å›ºå®šn=20ï¼Œpå˜åŒ–',
                xaxis: { title: 'æˆåŠŸæ¬¡æ•° k' },
                yaxis: { title: 'æ¦‚ç‡ P(X=k)' },
                height: 500,
                showlegend: true
            };

            Plotly.newPlot('plot1', traces, layout);
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            let statsHTML = '<h4>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h4>';
            pValues.forEach(p => {
                const mean = n * p;
                const variance = n * p * (1 - p);
                const std = Math.sqrt(variance);
                statsHTML += `<p><strong>p=${p}</strong>: Î¼=${mean.toFixed(1)}, ÏƒÂ²=${variance.toFixed(1)}, Ïƒ=${std.toFixed(2)}</p>`;
            });
            document.getElementById('stats').innerHTML = statsHTML;
        }

        // ç”Ÿæˆå›ºå®špï¼Œå˜åŒ–nçš„å¯è§†åŒ–
        function generateFixedP() {
            const p = 0.3;
            const nValues = [5, 10, 20, 30, 50];
            const colors = ['#e377c2', '#7f7f7f', '#bcbd22', '#17becf', '#ff7f0e'];
            
            const traces = [];
            
            nValues.forEach((n, index) => {
                const kMax = Math.min(n, Math.floor(n + 3 * Math.sqrt(n * p * (1 - p))));
                const k = Array.from({length: kMax + 1}, (_, i) => i);
                const pmf = k.map(ki => binomialPMF(ki, n, p));
                
                traces.push({
                    x: k,
                    y: pmf,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `n = ${n}`,
                    line: { color: colors[index], width: 3 },
                    marker: { size: 6, color: colors[index] }
                });
            });

            const layout = {
                title: 'äºŒé¡¹åˆ†å¸ƒ B(n,0.3) - å›ºå®šp=0.3ï¼Œnå˜åŒ–',
                xaxis: { title: 'æˆåŠŸæ¬¡æ•° k' },
                yaxis: { title: 'æ¦‚ç‡ P(X=k)' },
                height: 500,
                showlegend: true
            };

            Plotly.newPlot('plot1', traces, layout);
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            let statsHTML = '<h4>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h4>';
            nValues.forEach(n => {
                const mean = n * p;
                const variance = n * p * (1 - p);
                const std = Math.sqrt(variance);
                statsHTML += `<p><strong>n=${n}</strong>: Î¼=${mean.toFixed(1)}, ÏƒÂ²=${variance.toFixed(1)}, Ïƒ=${std.toFixed(2)}</p>`;
            });
            document.getElementById('stats').innerHTML = statsHTML;
        }

        // ç”Ÿæˆ3Då‚æ•°è¡¨é¢
        function generate3DSurface() {
            const nRange = Array.from({length: 21}, (_, i) => i + 5); // 5åˆ°25
            const pRange = Array.from({length: 19}, (_, i) => (i + 1) * 0.05); // 0.05åˆ°0.95
            
            // è®¡ç®—æœŸæœ›å€¼è¡¨é¢
            const zMean = [];
            const zVar = [];
            
            pRange.forEach(p => {
                const meanRow = [];
                const varRow = [];
                nRange.forEach(n => {
                    meanRow.push(n * p);
                    varRow.push(n * p * (1 - p));
                });
                zMean.push(meanRow);
                zVar.push(varRow);
            });

            // æœŸæœ›å€¼è¡¨é¢å›¾
            const trace1 = {
                x: nRange,
                y: pRange,
                z: zMean,
                type: 'surface',
                colorscale: 'Viridis',
                name: 'æœŸæœ›å€¼'
            };

            const layout1 = {
                title: 'äºŒé¡¹åˆ†å¸ƒæœŸæœ›å€¼ E[X] = nÃ—p',
                scene: {
                    xaxis: { title: 'è¯•éªŒæ¬¡æ•° n' },
                    yaxis: { title: 'æˆåŠŸæ¦‚ç‡ p' },
                    zaxis: { title: 'æœŸæœ›å€¼ E[X]' }
                },
                height: 500
            };

            Plotly.newPlot('plot1', [trace1], layout1);

            // æ–¹å·®è¡¨é¢å›¾
            const trace2 = {
                x: nRange,
                y: pRange,
                z: zVar,
                type: 'surface',
                colorscale: 'Plasma',
                name: 'æ–¹å·®'
            };

            const layout2 = {
                title: 'äºŒé¡¹åˆ†å¸ƒæ–¹å·® Var[X] = nÃ—pÃ—(1-p)',
                scene: {
                    xaxis: { title: 'è¯•éªŒæ¬¡æ•° n' },
                    yaxis: { title: 'æˆåŠŸæ¦‚ç‡ p' },
                    zaxis: { title: 'æ–¹å·® Var[X]' }
                },
                height: 500
            };

            Plotly.newPlot('plot2', [trace2], layout2);
            
            document.getElementById('stats').innerHTML = `
                <h4>ğŸ“Š 3Dåˆ†æè¯´æ˜</h4>
                <p><strong>æœŸæœ›å€¼ç‰¹å¾</strong>ï¼šE[X] = nÃ—p éšnå’Œpçº¿æ€§å¢é•¿</p>
                <p><strong>æ–¹å·®ç‰¹å¾</strong>ï¼šVar[X] = nÃ—pÃ—(1-p) åœ¨p=0.5æ—¶è¾¾åˆ°æœ€å¤§å€¼</p>
                <p><strong>å®é™…æ„ä¹‰</strong>ï¼šæ–¹å·®è¡¨ç¤ºåˆ†å¸ƒçš„ç¦»æ•£ç¨‹åº¦ï¼Œp=0.5æ—¶ä¸ç¡®å®šæ€§æœ€å¤§</p>
            `;
        }

        // ç”Ÿæˆå¯è§†åŒ–
        function generateVisualization() {
            const type = document.getElementById('visualization-type').value;
            
            // æ¸…ç©ºä¹‹å‰çš„å›¾è¡¨
            document.getElementById('plot2').innerHTML = '';
            
            switch(type) {
                case 'fixed-n':
                    generateFixedN();
                    break;
                case 'fixed-p':
                    generateFixedP();
                    break;
                case '3d-surface':
                    generate3DSurface();
                    break;
            }
        }

        // æ˜¾ç¤ºç¤ºä¾‹
        function showExample() {
            generateFixedN();
            
            // æ·»åŠ ç¤ºä¾‹è¯´æ˜
            setTimeout(() => {
                document.getElementById('stats').innerHTML += `
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 8px;">
                        <h4>ğŸ¯ è§‚å¯Ÿè¦ç‚¹</h4>
                        <ul>
                            <li><strong>p=0.1</strong>: åˆ†å¸ƒå³åï¼Œå¤§éƒ¨åˆ†æ¦‚ç‡é›†ä¸­åœ¨å°çš„kå€¼</li>
                            <li><strong>p=0.3</strong>: åˆ†å¸ƒä»ç„¶å³åï¼Œä½†å³°å€¼å‘å³ç§»åŠ¨</li>
                            <li><strong>p=0.5</strong>: åˆ†å¸ƒå¯¹ç§°ï¼Œå³°å€¼åœ¨k=10é™„è¿‘</li>
                            <li><strong>p=0.7</strong>: åˆ†å¸ƒå·¦åï¼Œå³°å€¼åœ¨k=14é™„è¿‘</li>
                            <li><strong>p=0.9</strong>: åˆ†å¸ƒæ˜æ˜¾å·¦åï¼Œå¤§éƒ¨åˆ†æ¦‚ç‡é›†ä¸­åœ¨å¤§çš„kå€¼</li>
                        </ul>
                    </div>
                `;
            }, 500);
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé»˜è®¤ç¤ºä¾‹
        window.onload = function() {
            showExample();
        };
    </script>
</body>
</html>
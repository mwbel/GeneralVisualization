<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒé¡¹åˆ†å¸ƒB(n,p)å‚æ•°å½±å“åˆ†æ</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #333;
            margin-top: 0;
            font-size: 1.8em;
            font-weight: 500;
        }
        
        .section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .plot-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .controls {
            background: #e9ecef;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .controls label {
            display: inline-block;
            margin-right: 15px;
            font-weight: 500;
            color: #333;
        }
        
        .controls select, .controls input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 15px;
        }
        
        .slider-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }
        
        .slider-group {
            margin-bottom: 20px;
        }
        
        .slider-group:last-child {
            margin-bottom: 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }
        
        .slider-value {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            min-width: 60px;
            text-align: center;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider:hover::-webkit-slider-thumb {
            background: #5a6fd8;
            transform: scale(1.1);
        }
        
        .slider:hover::-moz-range-thumb {
            background: #5a6fd8;
            transform: scale(1.1);
        }
        
        .interactive-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            border: 3px solid #667eea;
        }
        
        .interactive-title {
            color: #667eea;
            font-size: 2em;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .stats-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .explanation {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .explanation h3 {
            color: #856404;
            margin-top: 0;
        }
        
        .explanation ul {
            color: #856404;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>äºŒé¡¹åˆ†å¸ƒ B(n,p) å‚æ•°å½±å“åˆ†æ</h1>
            <p>æ¢ç´¢è¯•éªŒæ¬¡æ•°nå’ŒæˆåŠŸæ¦‚ç‡på¯¹äºŒé¡¹åˆ†å¸ƒçš„å½±å“</p>
        </div>
        
        <div class="content">
            <!-- äº¤äº’å¼æ»‘åŠ¨æ¡éƒ¨åˆ† -->
            <div class="interactive-section">
                <h2 class="interactive-title">ğŸ›ï¸ äº¤äº’å¼å‚æ•°æ§åˆ¶</h2>
                <p style="text-align: center; color: #666; margin-bottom: 30px;">
                    ä½¿ç”¨æ»‘åŠ¨æ¡å®æ—¶è°ƒæ•´å‚æ•°nå’Œpï¼Œè§‚å¯ŸäºŒé¡¹åˆ†å¸ƒçš„åŠ¨æ€å˜åŒ–
                </p>
                
                <div class="slider-container">
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>è¯•éªŒæ¬¡æ•° n</span>
                            <span class="slider-value" id="nValue">20</span>
                        </div>
                        <input type="range" id="nSlider" class="slider" min="5" max="100" value="20" 
                               oninput="updateInteractivePlot()">
                    </div>
                    
                    <div class="slider-group">
                        <div class="slider-label">
                            <span>æˆåŠŸæ¦‚ç‡ p</span>
                            <span class="slider-value" id="pValue">0.50</span>
                        </div>
                        <input type="range" id="pSlider" class="slider" min="0.01" max="0.99" step="0.01" value="0.50" 
                               oninput="updateInteractivePlot()">
                    </div>
                </div>
                
                <div class="plot-container">
                    <div id="interactivePlot"></div>
                </div>
                
                <div class="stats-box">
                    <h3>ğŸ“Š å®æ—¶ç»Ÿè®¡ç‰¹æ€§</h3>
                    <div id="interactiveStats" class="stats-grid"></div>
                </div>
                
                <div class="explanation">
                    <h3>ğŸ¯ å®æ—¶è§‚å¯Ÿè¦ç‚¹</h3>
                    <ul>
                        <li><strong>åˆ†å¸ƒå½¢çŠ¶</strong>: è§‚å¯Ÿpå€¼å¦‚ä½•å½±å“åˆ†å¸ƒçš„å¯¹ç§°æ€§å’Œååº¦</li>
                        <li><strong>æœŸæœ›å€¼ä½ç½®</strong>: çº¢è‰²è™šçº¿æ˜¾ç¤ºæœŸæœ›å€¼Î¼ = nÃ—pçš„ä½ç½®</li>
                        <li><strong>åˆ†å¸ƒå®½åº¦</strong>: æ–¹å·®åœ¨p=0.5æ—¶æœ€å¤§ï¼Œåˆ†å¸ƒæœ€å®½</li>
                        <li><strong>æ­£æ€è¿‘ä¼¼</strong>: nå¢å¤§æ—¶åˆ†å¸ƒè¶‹å‘æ­£æ€åˆ†å¸ƒ</li>
                    </ul>
                </div>
            </div>
            
            <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šå›ºå®šnï¼Œå˜åŒ–p -->
            <div class="section">
                <h2>ğŸ“Š å›ºå®šè¯•éªŒæ¬¡æ•°nï¼Œå˜åŒ–æˆåŠŸæ¦‚ç‡p</h2>
                <p>è§‚å¯Ÿå½“è¯•éªŒæ¬¡æ•°å›ºå®šæ—¶ï¼ŒæˆåŠŸæ¦‚ç‡pçš„å˜åŒ–å¦‚ä½•å½±å“åˆ†å¸ƒå½¢çŠ¶å’Œç»Ÿè®¡ç‰¹æ€§ã€‚</p>
                
                <div class="controls">
                    <label for="fixedN">å›ºå®šè¯•éªŒæ¬¡æ•° n:</label>
                    <select id="fixedN" onchange="updateFixedNPlot()">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="30">30</option>
                        <option value="50">50</option>
                    </select>
                </div>
                
                <div class="plot-container">
                    <div id="fixedNPlot"></div>
                </div>
                
                <div class="stats-box">
                    <h3>ğŸ“ˆ ç»Ÿè®¡ç‰¹æ€§å¯¹æ¯”</h3>
                    <div id="fixedNStats" class="stats-grid"></div>
                </div>
                
                <div class="explanation">
                    <h3>ğŸ” è§‚å¯Ÿè¦ç‚¹</h3>
                    <ul>
                        <li><strong>p = 0.1</strong>: åˆ†å¸ƒå³åï¼Œå¤§éƒ¨åˆ†æ¦‚ç‡é›†ä¸­åœ¨å°çš„kå€¼</li>
                        <li><strong>p = 0.5</strong>: åˆ†å¸ƒå¯¹ç§°ï¼Œå³°å€¼åœ¨æœŸæœ›å€¼ä½ç½®</li>
                        <li><strong>p = 0.9</strong>: åˆ†å¸ƒå·¦åï¼Œå¤§éƒ¨åˆ†æ¦‚ç‡é›†ä¸­åœ¨å¤§çš„kå€¼</li>
                        <li><strong>æ–¹å·®</strong>: åœ¨p=0.5æ—¶è¾¾åˆ°æœ€å¤§å€¼ nÃ—0.25</li>
                    </ul>
                </div>
            </div>
            
            <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šå›ºå®špï¼Œå˜åŒ–n -->
            <div class="section">
                <h2>ğŸ“ˆ å›ºå®šæˆåŠŸæ¦‚ç‡pï¼Œå˜åŒ–è¯•éªŒæ¬¡æ•°n</h2>
                <p>è§‚å¯Ÿå½“æˆåŠŸæ¦‚ç‡å›ºå®šæ—¶ï¼Œè¯•éªŒæ¬¡æ•°nçš„å˜åŒ–å¦‚ä½•å½±å“åˆ†å¸ƒå½¢çŠ¶ï¼ˆä¸­å¿ƒæé™å®šç†çš„ä½“ç°ï¼‰ã€‚</p>
                
                <div class="controls">
                    <label for="fixedP">å›ºå®šæˆåŠŸæ¦‚ç‡ p:</label>
                    <select id="fixedP" onchange="updateFixedPPlot()">
                        <option value="0.1">0.1</option>
                        <option value="0.3" selected>0.3</option>
                        <option value="0.5">0.5</option>
                        <option value="0.7">0.7</option>
                        <option value="0.9">0.9</option>
                    </select>
                </div>
                
                <div class="plot-container">
                    <div id="fixedPPlot"></div>
                </div>
                
                <div class="stats-box">
                    <h3>ğŸ“Š ç»Ÿè®¡ç‰¹æ€§å˜åŒ–</h3>
                    <div id="fixedPStats" class="stats-grid"></div>
                </div>
                
                <div class="explanation">
                    <h3>ğŸ” è§‚å¯Ÿè¦ç‚¹</h3>
                    <ul>
                        <li><strong>å°nå€¼</strong>: åˆ†å¸ƒç¦»æ•£ï¼Œå½¢çŠ¶ä¸è§„åˆ™</li>
                        <li><strong>ä¸­ç­‰nå€¼</strong>: åˆ†å¸ƒå¼€å§‹æ˜¾ç°é’Ÿå½¢ç‰¹å¾</li>
                        <li><strong>å¤§nå€¼</strong>: åˆ†å¸ƒè¶‹å‘æ­£æ€åˆ†å¸ƒï¼ˆä¸­å¿ƒæé™å®šç†ï¼‰</li>
                        <li><strong>æ ‡å‡†å·®</strong>: éšâˆšnå¢é•¿ï¼Œç›¸å¯¹å˜å¼‚ç³»æ•°å‡å°</li>
                    </ul>
                </div>
            </div>
            
            <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼š3Då‚æ•°è¡¨é¢ -->
            <div class="section">
                <h2>ğŸŒ 3Då‚æ•°è¡¨é¢åˆ†æ</h2>
                <p>é€šè¿‡3Då¯è§†åŒ–åŒæ—¶è§‚å¯Ÿnå’Œpå¯¹æœŸæœ›å€¼å’Œæ–¹å·®çš„å½±å“ã€‚</p>
                
                <div class="controls">
                    <label for="surfaceType">é€‰æ‹©è¡¨é¢ç±»å‹:</label>
                    <select id="surfaceType" onchange="update3DSurface()">
                        <option value="mean" selected>æœŸæœ›å€¼ E[X] = nÃ—p</option>
                        <option value="variance">æ–¹å·® Var[X] = nÃ—pÃ—(1-p)</option>
                        <option value="std">æ ‡å‡†å·® Ïƒ = âˆš(nÃ—pÃ—(1-p))</option>
                        <option value="cv">å˜å¼‚ç³»æ•° CV = Ïƒ/Î¼</option>
                    </select>
                </div>
                
                <div class="plot-container">
                    <div id="surface3DPlot"></div>
                </div>
                
                <div class="explanation">
                    <h3>ğŸ” 3Dè¡¨é¢ç‰¹å¾</h3>
                    <ul>
                        <li><strong>æœŸæœ›å€¼è¡¨é¢</strong>: çº¿æ€§å¹³é¢ï¼Œéšnå’ŒpåŒæ—¶å¢å¤§</li>
                        <li><strong>æ–¹å·®è¡¨é¢</strong>: å±±è„ŠçŠ¶ï¼Œåœ¨p=0.5æ—¶è¾¾åˆ°å³°å€¼</li>
                        <li><strong>æ ‡å‡†å·®è¡¨é¢</strong>: ç±»ä¼¼æ–¹å·®ä½†å¢é•¿æ›´ç¼“æ…¢</li>
                        <li><strong>å˜å¼‚ç³»æ•°è¡¨é¢</strong>: éšnå¢å¤§è€Œå‡å°ï¼Œä½“ç°å¤§æ•°å®šå¾‹</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // äºŒé¡¹åˆ†å¸ƒæ¦‚ç‡è´¨é‡å‡½æ•°
        function binomialPMF(k, n, p) {
            if (k < 0 || k > n) return 0;
            
            // è®¡ç®—ç»„åˆæ•° C(n,k)
            let logComb = 0;
            for (let i = 1; i <= k; i++) {
                logComb += Math.log(n - i + 1) - Math.log(i);
            }
            
            // è®¡ç®—æ¦‚ç‡
            if (p === 0) return k === 0 ? 1 : 0;
            if (p === 1) return k === n ? 1 : 0;
            
            const logProb = logComb + k * Math.log(p) + (n - k) * Math.log(1 - p);
            return Math.exp(logProb);
        }
        
        // è®¡ç®—äºŒé¡¹åˆ†å¸ƒç»Ÿè®¡é‡
        function binomialStats(n, p) {
            const mean = n * p;
            const variance = n * p * (1 - p);
            const std = Math.sqrt(variance);
            const cv = mean > 0 ? std / mean : 0;
            return { mean, variance, std, cv };
        }
        
        // æ›´æ–°å›ºå®šnçš„å›¾è¡¨
        function updateFixedNPlot() {
            const n = parseInt(document.getElementById('fixedN').value);
            const pValues = [0.1, 0.3, 0.5, 0.7, 0.9];
            const colors = ['#e74c3c', '#f39c12', '#2ecc71', '#3498db', '#9b59b6'];
            
            const traces = [];
            const statsData = [];
            
            pValues.forEach((p, i) => {
                const kValues = Array.from({length: n + 1}, (_, k) => k);
                const probabilities = kValues.map(k => binomialPMF(k, n, p));
                const stats = binomialStats(n, p);
                
                traces.push({
                    x: kValues,
                    y: probabilities,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `p=${p}`,
                    line: { color: colors[i], width: 3 },
                    marker: { size: 6, color: colors[i] }
                });
                
                // æ·»åŠ æœŸæœ›å€¼å‚ç›´çº¿
                traces.push({
                    x: [stats.mean, stats.mean],
                    y: [0, Math.max(...probabilities)],
                    type: 'scatter',
                    mode: 'lines',
                    name: `Î¼=${stats.mean.toFixed(1)}`,
                    line: { color: colors[i], width: 2, dash: 'dash' },
                    showlegend: false
                });
                
                statsData.push({
                    p: p,
                    mean: stats.mean,
                    variance: stats.variance,
                    std: stats.std,
                    cv: stats.cv,
                    color: colors[i]
                });
            });
            
            const layout = {
                title: `äºŒé¡¹åˆ†å¸ƒ B(${n}, p) - å›ºå®šn=${n}ï¼Œå˜åŒ–p`,
                xaxis: { title: 'æˆåŠŸæ¬¡æ•° k' },
                yaxis: { title: 'æ¦‚ç‡ P(X=k)' },
                showlegend: true,
                legend: { x: 0.02, y: 0.98 },
                template: 'plotly_white',
                height: 500
            };
            
            Plotly.newPlot('fixedNPlot', traces, layout);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStatsDisplay('fixedNStats', statsData, 'p');
        }
        
        // æ›´æ–°å›ºå®špçš„å›¾è¡¨
        function updateFixedPPlot() {
            const p = parseFloat(document.getElementById('fixedP').value);
            const nValues = [5, 10, 20, 30, 50];
            const colors = ['#e74c3c', '#f39c12', '#2ecc71', '#3498db', '#9b59b6'];
            
            const traces = [];
            const statsData = [];
            
            nValues.forEach((n, i) => {
                const kValues = Array.from({length: n + 1}, (_, k) => k);
                const probabilities = kValues.map(k => binomialPMF(k, n, p));
                const stats = binomialStats(n, p);
                
                traces.push({
                    x: kValues,
                    y: probabilities,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: `n=${n}`,
                    line: { color: colors[i], width: 3 },
                    marker: { size: 4, color: colors[i] }
                });
                
                // æ·»åŠ æœŸæœ›å€¼å‚ç›´çº¿
                traces.push({
                    x: [stats.mean, stats.mean],
                    y: [0, Math.max(...probabilities)],
                    type: 'scatter',
                    mode: 'lines',
                    name: `Î¼=${stats.mean.toFixed(1)}`,
                    line: { color: colors[i], width: 2, dash: 'dash' },
                    showlegend: false
                });
                
                statsData.push({
                    n: n,
                    mean: stats.mean,
                    variance: stats.variance,
                    std: stats.std,
                    cv: stats.cv,
                    color: colors[i]
                });
            });
            
            const layout = {
                title: `äºŒé¡¹åˆ†å¸ƒ B(n, ${p}) - å›ºå®šp=${p}ï¼Œå˜åŒ–n`,
                xaxis: { title: 'æˆåŠŸæ¬¡æ•° k' },
                yaxis: { title: 'æ¦‚ç‡ P(X=k)' },
                showlegend: true,
                legend: { x: 0.02, y: 0.98 },
                template: 'plotly_white',
                height: 500
            };
            
            Plotly.newPlot('fixedPPlot', traces, layout);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStatsDisplay('fixedPStats', statsData, 'n');
        }
        
        // æ›´æ–°3Dè¡¨é¢å›¾
        function update3DSurface() {
            const surfaceType = document.getElementById('surfaceType').value;
            
            const nRange = Array.from({length: 20}, (_, i) => 5 + i * 2.5); // 5 to 52.5
            const pRange = Array.from({length: 20}, (_, i) => 0.05 + i * 0.045); // 0.05 to 0.905
            
            const zData = [];
            let title, zTitle;
            
            for (let i = 0; i < pRange.length; i++) {
                const row = [];
                for (let j = 0; j < nRange.length; j++) {
                    const n = nRange[j];
                    const p = pRange[i];
                    const stats = binomialStats(n, p);
                    
                    switch (surfaceType) {
                        case 'mean':
                            row.push(stats.mean);
                            title = 'æœŸæœ›å€¼è¡¨é¢ E[X] = nÃ—p';
                            zTitle = 'æœŸæœ›å€¼';
                            break;
                        case 'variance':
                            row.push(stats.variance);
                            title = 'æ–¹å·®è¡¨é¢ Var[X] = nÃ—pÃ—(1-p)';
                            zTitle = 'æ–¹å·®';
                            break;
                        case 'std':
                            row.push(stats.std);
                            title = 'æ ‡å‡†å·®è¡¨é¢ Ïƒ = âˆš(nÃ—pÃ—(1-p))';
                            zTitle = 'æ ‡å‡†å·®';
                            break;
                        case 'cv':
                            row.push(stats.cv);
                            title = 'å˜å¼‚ç³»æ•°è¡¨é¢ CV = Ïƒ/Î¼';
                            zTitle = 'å˜å¼‚ç³»æ•°';
                            break;
                    }
                }
                zData.push(row);
            }
            
            const trace = {
                x: nRange,
                y: pRange,
                z: zData,
                type: 'surface',
                colorscale: surfaceType === 'variance' ? 'Plasma' : 'Viridis'
            };
            
            const layout = {
                title: title,
                scene: {
                    xaxis: { title: 'è¯•éªŒæ¬¡æ•° n' },
                    yaxis: { title: 'æˆåŠŸæ¦‚ç‡ p' },
                    zaxis: { title: zTitle }
                },
                height: 600
            };
            
            Plotly.newPlot('surface3DPlot', [trace], layout);
        }
        
        // æ›´æ–°äº¤äº’å¼å›¾è¡¨
        function updateInteractivePlot() {
            const n = parseInt(document.getElementById('nSlider').value);
            const p = parseFloat(document.getElementById('pSlider').value);
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('nValue').textContent = n;
            document.getElementById('pValue').textContent = p.toFixed(2);
            
            // ç”Ÿæˆæ•°æ®
            const kValues = Array.from({length: n + 1}, (_, k) => k);
            const probabilities = kValues.map(k => binomialPMF(k, n, p));
            const stats = binomialStats(n, p);
            
            // åˆ›å»ºä¸»è¦åˆ†å¸ƒå›¾
            const mainTrace = {
                x: kValues,
                y: probabilities,
                type: 'scatter',
                mode: 'lines+markers',
                name: `B(${n}, ${p.toFixed(2)})`,
                line: { color: '#667eea', width: 4 },
                marker: { size: 8, color: '#667eea' },
                fill: 'tonexty',
                fillcolor: 'rgba(102, 126, 234, 0.1)'
            };
            
            // æœŸæœ›å€¼çº¿
            const meanLine = {
                x: [stats.mean, stats.mean],
                y: [0, Math.max(...probabilities) * 1.1],
                type: 'scatter',
                mode: 'lines',
                name: `æœŸæœ›å€¼ Î¼=${stats.mean.toFixed(1)}`,
                line: { color: '#e74c3c', width: 3, dash: 'dash' }
            };
            
            // æ ‡å‡†å·®èŒƒå›´
            const stdRange1 = {
                x: [Math.max(0, stats.mean - stats.std), Math.max(0, stats.mean - stats.std)],
                y: [0, Math.max(...probabilities) * 0.8],
                type: 'scatter',
                mode: 'lines',
                name: `Î¼-Ïƒ`,
                line: { color: '#f39c12', width: 2, dash: 'dot' },
                showlegend: false
            };
            
            const stdRange2 = {
                x: [Math.min(n, stats.mean + stats.std), Math.min(n, stats.mean + stats.std)],
                y: [0, Math.max(...probabilities) * 0.8],
                type: 'scatter',
                mode: 'lines',
                name: `Î¼+Ïƒ`,
                line: { color: '#f39c12', width: 2, dash: 'dot' },
                showlegend: false
            };
            
            // æ­£æ€è¿‘ä¼¼ï¼ˆå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼‰
            let normalTrace = null;
            if (n >= 20 && n * p >= 5 && n * (1 - p) >= 5) {
                const normalX = [];
                const normalY = [];
                for (let k = 0; k <= n; k++) {
                    const z = (k - stats.mean) / stats.std;
                    const normalProb = (1 / (stats.std * Math.sqrt(2 * Math.PI))) * 
                                     Math.exp(-0.5 * z * z);
                    normalX.push(k);
                    normalY.push(normalProb);
                }
                
                normalTrace = {
                    x: normalX,
                    y: normalY,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'æ­£æ€è¿‘ä¼¼',
                    line: { color: '#2ecc71', width: 2, dash: 'dashdot' },
                    opacity: 0.7
                };
            }
            
            const traces = [mainTrace, meanLine, stdRange1, stdRange2];
            if (normalTrace) traces.push(normalTrace);
            
            const layout = {
                title: `äºŒé¡¹åˆ†å¸ƒ B(${n}, ${p.toFixed(2)}) - äº¤äº’å¼å¯è§†åŒ–`,
                xaxis: { 
                    title: 'æˆåŠŸæ¬¡æ•° k',
                    range: [-0.5, n + 0.5]
                },
                yaxis: { 
                    title: 'æ¦‚ç‡ P(X=k)',
                    range: [0, Math.max(...probabilities) * 1.2]
                },
                showlegend: true,
                legend: { x: 0.02, y: 0.98 },
                template: 'plotly_white',
                height: 500,
                annotations: [
                    {
                        x: stats.mean,
                        y: Math.max(...probabilities) * 1.15,
                        text: `Î¼ = ${stats.mean.toFixed(1)}`,
                        showarrow: true,
                        arrowhead: 2,
                        arrowcolor: '#e74c3c',
                        font: { color: '#e74c3c', size: 12 }
                    }
                ]
            };
            
            Plotly.newPlot('interactivePlot', traces, layout);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateInteractiveStats(n, p, stats);
        }
        
        // æ›´æ–°äº¤äº’å¼ç»Ÿè®¡ä¿¡æ¯
        function updateInteractiveStats(n, p, stats) {
            const container = document.getElementById('interactiveStats');
            
            // è®¡ç®—é¢å¤–ç»Ÿè®¡é‡
            const skewness = (1 - 2 * p) / Math.sqrt(n * p * (1 - p));
            const kurtosis = (1 - 6 * p * (1 - p)) / (n * p * (1 - p));
            const mode = Math.floor((n + 1) * p);
            
            container.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">n = ${n}</div>
                    <div class="stat-label">è¯•éªŒæ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">p = ${p.toFixed(2)}</div>
                    <div class="stat-label">æˆåŠŸæ¦‚ç‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.mean.toFixed(1)}</div>
                    <div class="stat-label">æœŸæœ›å€¼ Î¼</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.variance.toFixed(1)}</div>
                    <div class="stat-label">æ–¹å·® ÏƒÂ²</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.std.toFixed(2)}</div>
                    <div class="stat-label">æ ‡å‡†å·® Ïƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.cv.toFixed(3)}</div>
                    <div class="stat-label">å˜å¼‚ç³»æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${mode}</div>
                    <div class="stat-label">ä¼—æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${skewness.toFixed(3)}</div>
                    <div class="stat-label">ååº¦</div>
                </div>
            `;
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
        function updateStatsDisplay(containerId, statsData, paramName) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            statsData.forEach(data => {
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                statItem.style.borderLeft = `4px solid ${data.color}`;
                
                const paramValue = paramName === 'p' ? data.p : data.n;
                
                statItem.innerHTML = `
                    <div class="stat-value">${paramName}=${paramValue}</div>
                    <div class="stat-label">Î¼=${data.mean.toFixed(1)}</div>
                    <div class="stat-label">ÏƒÂ²=${data.variance.toFixed(1)}</div>
                    <div class="stat-label">Ïƒ=${data.std.toFixed(2)}</div>
                    <div class="stat-label">CV=${data.cv.toFixed(3)}</div>
                `;
                
                container.appendChild(statItem);
            });
        }
        
        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            updateInteractivePlot();
            updateFixedNPlot();
            updateFixedPPlot();
            update3DSurface();
        });
    </script>
</body>
</html>